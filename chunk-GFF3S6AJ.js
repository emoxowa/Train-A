import{a as D}from"./chunk-4SNVB2N5.js";import{a as de}from"./chunk-GQC6GBTQ.js";import{c as ae}from"./chunk-PT7V5Q2Q.js";import{a as ge}from"./chunk-346BXNRU.js";import{b as _e}from"./chunk-WNQC6ED5.js";import{b as ue}from"./chunk-QJ4XV6RO.js";import{a as ce,b as Ce}from"./chunk-4EZILGJR.js";import{a as Q}from"./chunk-LRBDKUDH.js";import{d as oe}from"./chunk-IMOUA4KZ.js";import{hb as V,x as re}from"./chunk-FEYVFRDP.js";import{o as N,p as pe}from"./chunk-RR4QGK55.js";import{b as le,e as se,f as me}from"./chunk-EH7XB44O.js";import{$b as te,A as K,Ab as Z,Bb as L,Ca as M,Cb as O,Db as l,Eb as o,Fb as m,Jb as y,M as X,Ma as f,Mb as R,Na as v,Nb as a,Sb as b,Tb as S,Ub as T,Uc as ne,Wb as s,Xb as q,Xc as k,Yb as w,_b as ee,ac as ie,bc as E,cc as A,db as c,dc as _,fc as B,ha as j,k as J,lc as $,mc as F,t as P,tb as p,ub as g,va as h,vb as C,yb as u}from"./chunk-2XEAWUUP.js";import{a as Y,b as G}from"./chunk-T527G4PA.js";var be=n=>n,xe=pe(be,n=>n.riderListState.riderList);var Ee=["timeInputDepart"],De=["timeInputArrive"],we=["carriageInput"],Ae=["carriageName"],Pe=(n,i)=>i[0];function Le(n,i){if(n&1&&(l(0,"h3",4),s(1),o()),n&2){let e=a();c(),w("Ride ",e.idRide,"")}}function Oe(n,i){if(n&1&&(l(0,"div",16)(1,"span"),s(2,"depart"),o(),m(3,"input",18,0),o()),n&2){let e=a(3).$implicit,t=_(0),r=a();c(3),C("value",r.formatToDateTimeLocal(t.segments[e].time[0])),g("data-index",e)}}function Me(n,i){if(n&1&&(l(0,"div",17)(1,"span"),s(2,"arrive"),o(),m(3,"input",18,1),o()),n&2){let e=a(3).$implicit,t=_(0),r=a();c(3),C("value",r.formatToDateTimeLocal(t.segments[e-1].time[1])),g("data-index",e)}}function Be(n,i){if(n&1&&(l(0,"div",17)(1,"span"),s(2,"arrive"),o(),m(3,"input",18,1),o(),l(5,"div",16)(6,"span"),s(7,"depart "),o(),m(8,"input",18,0),o()),n&2){let e=a(3).$implicit,t=_(0),r=a();c(3),C("value",r.formatToDateTimeLocal(t.segments[e-1].time[1])),g("data-index",e),c(5),C("value",r.formatToDateTimeLocal(t.segments[e].time[0])),g("data-index",e)}}function $e(n,i){if(n&1&&p(0,Oe,5,2,"div",16)(1,Me,5,2,"div",17)(2,Be,10,4),n&2){let e=a(2).$implicit,t=a();u(e===0?0:e===t.rideSchedule.length?1:2)}}function Fe(n,i){if(n&1&&p(0,$e,3,1),n&2){a();let e=_(0);u(e?0:-1)}}function ke(n,i){if(n&1&&(l(0,"div",16)(1,"span"),s(2,"depart"),o(),m(3,"input",19,0),o()),n&2){let e=a(3).$implicit,t=_(0),r=a();c(3),C("value",r.formatToDateTimeLocal(t.segments[e].time[0]))("disabled",!0),g("data-index",e)}}function Ve(n,i){if(n&1&&(l(0,"div",17)(1,"span"),s(2,"arrive"),o(),m(3,"input",19,1),o()),n&2){let e=a(3).$implicit,t=_(0),r=a();c(3),C("value",r.formatToDateTimeLocal(t.segments[e-1].time[1]))("disabled",!0),g("data-index",e)}}function Qe(n,i){if(n&1&&(l(0,"div",17)(1,"span"),s(2,"arrive"),o(),m(3,"input",19,1),o(),l(5,"div",16)(6,"span"),s(7,"depart "),o(),m(8,"input",19,0),o()),n&2){let e=a(3).$implicit,t=_(0),r=a();c(3),C("value",r.formatToDateTimeLocal(t.segments[e-1].time[1]))("disabled",!0),g("data-index",e),c(5),C("value",r.formatToDateTimeLocal(t.segments[e].time[0]))("disabled",!0),g("data-index",e)}}function Ne(n,i){if(n&1&&p(0,ke,5,3,"div",16)(1,Ve,5,3,"div",17)(2,Qe,10,6),n&2){let e=a(2).$implicit,t=a();u(e===0?0:e===t.rideSchedule.length?1:2)}}function Ue(n,i){if(n&1&&p(0,Ne,3,1),n&2){a();let e=_(0);u(e?0:-1)}}function ze(n,i){if(n&1){let e=y();l(0,"button",20),R("click",function(){f(e);let r=a().$implicit,d=a();return v(d.toggleEditTime(r))}),m(1,"tui-icon",21),o()}}function He(n,i){if(n&1){let e=y();l(0,"button",22),R("click",function(){f(e);let r=a().$implicit,d=a();return v(d.toggleEditTime(r))})("click",function(){f(e);let r=a().$implicit,d=a();return v(d.saveRide(r))}),m(1,"tui-icon",23),o()}}function je(n,i){if(n&1&&(l(0,"div",25)(1,"span",null,2),s(3),o(),m(4,"input",26,3),o()),n&2){let e=a().$implicit,t=a(2).$implicit;c(),g("data-index",t),c(2),q(e[0]),c(),C("value",e[1])("disabled",!0),g("data-index",t)}}function qe(n,i){if(n&1&&(l(0,"div",25)(1,"span",null,2),s(3),o(),m(4,"input",27,3),o()),n&2){let e=a().$implicit,t=a(2).$implicit;c(),g("data-index",t),c(2),q(e[0]),c(),C("value",e[1]),g("data-index",t)}}function We(n,i){if(n&1&&p(0,je,6,5,"div",25)(1,qe,6,4,"div",25),n&2){let e=a(2).$implicit,t=a();u(t.isEditingPrice[e]?t.isEditingPrice[e]?1:-1:0)}}function Ye(n,i){if(n&1){let e=y();l(0,"button",20),R("click",function(){f(e);let r=a(2).$implicit,d=a();return v(d.toggleEditPrice(r))}),m(1,"tui-icon",21),o()}}function Ge(n,i){if(n&1){let e=y();l(0,"button",22),R("click",function(){f(e);let r=a(2).$implicit,d=a();return v(d.toggleEditPrice(r))})("click",function(){f(e);let r=a(2).$implicit,d=a();return v(d.saveRide(r))}),m(1,"tui-icon",23),o()}}function Je(n,i){if(n&1&&(E(0),l(1,"div",24),L(2,We,2,1,null,null,Pe),o(),p(4,Ye,2,0,"button",13)(5,Ge,2,0,"button",14)),n&2){let e=a().$implicit,t=_(0),r=a(),d=r.getCarriagePriceArray(t.segments[e].price);c(2),O(d),c(2),u(r.isEditingPrice[e]?r.isEditingPrice[e]?5:-1:4)}}function Ke(n,i){if(n&1&&(E(0),l(1,"div",8)(2,"div",9)(3,"div",10),s(4),o()(),l(5,"div",11)(6,"div",12),p(7,Fe,1,1)(8,Ue,1,1),o(),p(9,ze,2,0,"button",13)(10,He,2,0,"button",14),o()(),l(11,"div",8)(12,"div",15),p(13,Je,6,1),o()()),n&2){let e=i.$implicit,t=a(),r=A(t.findSegmentByRiderId(t.idRide));c(4),w(" ",t.getCityById(t.cityRide[e])," "),c(3),u(t.isEditingTime[e]?7:t.isEditingTime[e]?-1:8),c(2),u(t.isEditingTime[e]?t.isEditingTime[e]?10:-1:9),c(4),u(r&&e!==t.rideSchedule.length?13:-1)}}function Xe(n,i){if(n&1){let e=y();l(0,"button",28),R("click",function(){f(e);let r=a();return v(r.onDeleteRide())}),s(1," Delete "),o()}}function Ze(n,i){if(n&1){let e=y();l(0,"div",29)(1,"h2",4),s(2),o(),l(3,"button",30),R("click",function(){f(e);let r=a();return v(r.onDeleteConfirm())}),s(4,"Confirm"),o()()}if(n&2){let e=a();c(2),w("Are you sure you want to delete the Ride ",e.idRide,"?")}}var U=class n{rideInfo;routeId;rideSchedule;idRide;cityRide;carriageRide;stationDataAllUpd;carriagesDataAllUpd;isEditingPrice=[];isEditingTime=[];citiesNumbers=[];timeInputsDepart;timeInputsArrive;carriageInputs;carriageName;store=h(N);isDeleteDialogOpen=!1;departInFuture=!1;ngOnInit(){this.isEditingPrice=new Array(this.rideSchedule.length).fill(!1),this.isEditingTime=new Array(this.rideSchedule.length).fill(!1),this.citiesNumbers=Array(this.rideSchedule.length+1).fill(null).map((i,e)=>e),this.departInFuture=new Date(this.rideSchedule[0].time[0]).getTime()-new Date().getTime()>0}toggleEditPrice(i){this.isEditingPrice[i]=!this.isEditingPrice[i]}toggleEditTime(i){this.isEditingTime[i]=!this.isEditingTime[i]}formatToDateTimeLocal(i){let e=new Date(i),t=e.getFullYear(),r=(e.getMonth()+1).toString().padStart(2,"0"),d=e.getDate().toString().padStart(2,"0"),x=e.getHours().toString().padStart(2,"0"),I=e.getMinutes().toString().padStart(2,"0");return`${t}-${r}-${d}T${x}:${I}`}getCarriagePriceArray(i){return Object.entries(i)}getCityById(i){if(this.stationDataAllUpd){let e=this.stationDataAllUpd.find(t=>t.id===i);return e?e.city:""}return""}getCarriageByCode(i){if(this.carriagesDataAllUpd){let e=this.carriagesDataAllUpd.find(t=>t.code===i);return e?e.name:""}return""}findSegmentByRiderId(i){return this.rideInfo.schedule.find(e=>e.rideId===i)}saveRide(i){let e=this.getValuesByIndex(this.timeInputsDepart,i,"data-index"),t=this.getValuesByIndex(this.timeInputsArrive,i,"data-index"),r=this.getValuesByIndex(this.timeInputsDepart,i-1,"data-index"),d=this.getValuesByIndex(this.timeInputsArrive,i+1,"data-index"),x=this.getValuesByIndex(this.carriageInputs,i,"data-index"),I=this.getTextContentByIndex(this.carriageName,i,"data-index"),z=[...r,...t],ve=[...e,...d],Ie=this.mapCarriagePrices(I,x),he=this.rideSchedule.map((ye,W,Re)=>W===i?{price:Ie,time:ve.map(H=>new Date(H).toISOString())}:W+1===i?G(Y({},Re[i-1]),{time:z.map(H=>new Date(H).toISOString())}):ye);this.store.dispatch(D.updateRide({scheduleItem:{rideId:this.idRide,segments:he},routeId:this.routeId}))}onDeleteRide(){this.isDeleteDialogOpen=!0}onDeleteConfirm(){this.store.dispatch(D.deleteRide({routeId:this.routeId,rideId:this.idRide}))}mapCarriagePrices(i,e){let t=i.filter(d=>d!==null),r={};for(let d=0;d<t.length;d+=1){let x=t[d];r[x]=Number(e[d])}return r}getValuesByIndex(i,e,t){return i.filter(r=>parseInt(r.nativeElement.getAttribute(t)||"",10)===e).map(r=>r.nativeElement.value)}getTextContentByIndex(i,e,t){return i.filter(r=>parseInt(r.nativeElement.getAttribute(t)||"",10)===e).map(r=>r.nativeElement.textContent)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=M({type:n,selectors:[["app-ride-card"]],viewQuery:function(e,t){if(e&1&&(b(Ee,5),b(De,5),b(we,5),b(Ae,5)),e&2){let r;S(r=T())&&(t.timeInputsDepart=r),S(r=T())&&(t.timeInputsArrive=r),S(r=T())&&(t.carriageInputs=r),S(r=T())&&(t.carriageName=r)}},inputs:{rideInfo:"rideInfo",routeId:"routeId",rideSchedule:"rideSchedule",idRide:"idRide",cityRide:"cityRide",carriageRide:"carriageRide",stationDataAllUpd:"stationDataAllUpd",carriagesDataAllUpd:"carriagesDataAllUpd"},standalone:!0,features:[B],decls:6,vars:3,consts:[["timeInputDepart",""],["timeInputArrive",""],["carriageName",""],["carriageInput",""],["tuiTitle","m"],["tuiCardLarge","compact","tuiSurface","elevated"],["size","s","tuiButton","","appearance","destructive",1,"ride-card__edit-carriage"],[3,"tuiDialogChange","tuiDialog"],[1,"ride-card"],[1,"ride-card__city"],[1,"ride-card__city-element"],[1,"ride-card__time"],[1,"ride-card__time-inputs"],["size","s","tuiButton","",1,"ride-card__edit-carriage"],["size","s","tuiButton",""],[1,"ride-card__carriage"],[1,"ride-card__time-input_depart"],[1,"ride-card__time-input_arrive"],["type","datetime-local",1,"ride-card__time-input",3,"value"],["type","datetime-local",1,"ride-card__time-input",3,"value","disabled"],["size","s","tuiButton","",1,"ride-card__edit-carriage",3,"click"],["icon","@tui.pencil"],["size","s","tuiButton","",3,"click"],["icon","@tui.save"],[1,"ride-card__prices"],[1,"ride-card__cariage-element"],["type","number",1,"ride-card__carriage-input",3,"value","disabled"],["type","number",1,"ride-card__carriage-input",3,"value"],["size","s","tuiButton","","appearance","destructive",1,"ride-card__edit-carriage",3,"click"],[1,"confirm-dialog"],["tuiButton","","appearance","destructive",3,"click"]],template:function(e,t){e&1&&(p(0,Le,2,1,"h3",4),l(1,"div",5),L(2,Ke,14,5,null,null,Z),o(),p(4,Xe,2,0,"button",6)(5,Ze,5,1,"ng-template",7),ie("tuiDialogChange",function(d){return te(t.isDeleteDialogOpen,d)||(t.isDeleteDialogOpen=d),d})),e&2&&(u(t.rideSchedule?0:-1),c(2),O(t.citiesNumbers),c(2),u(t.departInFuture?4:-1),c(),ee("tuiDialog",t.isDeleteDialogOpen))},dependencies:[k,re,Q,Ce,ce,V,de,oe],styles:['[_ngcontent-%COMP%]:root{--auth-font-weight: 600;--auth-container-width: 300px;--auth-container-padding: 20px;--auth-form-flex-gap: 20px;--auth-input-padding: 10px 5px}[_nghost-%COMP%]{display:flex;flex-direction:column;gap:1rem}.ride-card[_ngcontent-%COMP%]{display:grid;grid-template-areas:"city time price";grid-template-columns:60px auto 180px;gap:2rem}.ride-card__city[_ngcontent-%COMP%], .ride-card__time[_ngcontent-%COMP%], .ride-card__carriage[_ngcontent-%COMP%]{display:flex;gap:1rem;align-items:flex-start}.ride-card__city[_ngcontent-%COMP%]{grid-area:city}.ride-card__time[_ngcontent-%COMP%]{display:flex;grid-area:time;align-items:center;justify-content:center}.ride-card__carriage[_ngcontent-%COMP%]{grid-area:price}.ride-card__prices[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.ride-card__cariage-element[_ngcontent-%COMP%]{display:flex;gap:.5rem;align-items:center}.ride-card__time-inputs[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.ride-card__carriage-input[_ngcontent-%COMP%]{width:50px}.ride-card__time-input_depart[_ngcontent-%COMP%], .ride-card__time-input_arrive[_ngcontent-%COMP%]{display:flex;gap:.5rem;align-items:center;justify-content:space-between}.confirm-dialog[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem;align-items:flex-start}@media (min-width: 425px) and (max-width: 767px){.ride-card[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.25rem}.ride-card__time[_ngcontent-%COMP%]{justify-content:flex-start}.ride-card[_ngcontent-%COMP%]:not(:first-child){padding-top:1.25rem;border-top:1px solid grey}}@media (min-width: 320px) and (max-width: 424px){.ride-card[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.25rem}.ride-card__time[_ngcontent-%COMP%]{justify-content:flex-start}.ride-card[_ngcontent-%COMP%]:not(:first-child){padding-top:1.25rem;border-top:1px solid grey}}']})};var et=["addRideButton"],tt=(n,i)=>i.rideId;function it(n,i){if(n&1&&m(0,"app-ride-card",6),n&2){let e=a().$implicit,t=a(2),r=_(9),d=_(11),x=_(13);C("carriagesDataAllUpd",x)("stationDataAllUpd",d)("cityRide",r.path)("idRide",e.rideId)("rideSchedule",e.segments)("carriageRide",r.carriages)("rideInfo",r)("routeId",t.routeId)}}function nt(n,i){if(n&1&&p(0,it,1,8,"app-ride-card",6),n&2){let e=i.$implicit;u(e.rideId?0:-1)}}function rt(n,i){if(n&1&&L(0,nt,1,1,null,null,tt),n&2){a();let e=_(9);O(e.schedule)}}var fe=class n{defaultCarriagePrice=1e3;addRideButton;route=h(le);orderService=h(ge);alerts=h(ae);alertsSubscription=this.orderService.alertMessage$.pipe(j(i=>i?this.alerts.open(i.message,{appearance:i.type}):J)).subscribe();store=h(N);addRideButtonSubscription;routeId=Number(this.route.snapshot.params.id);stationArr$=this.store.select(_e);carriagesArr$=this.store.select(ue);riderInfo$=this.store.select(xe);defaultRideSchedule$=this.riderInfo$.pipe(P(i=>{let e=new Date().getTime(),t=i.path.length,r=Array.from(new Set(i.carriages)),d={},x=1e3*60*60*2;return r.forEach(I=>{d[I]=this.defaultCarriagePrice}),{segments:new Array(t-1).fill(null).map(()=>{e+=2*x;let I=new Date(e).toISOString(),z=new Date(e+x).toISOString();return{time:[I,z],price:d}})}}));ngOnInit(){this.store.dispatch(D.loadRiderList({idRoute:this.routeId}))}ngAfterViewInit(){this.createAddRideSubscription()}ngOnDestroy(){this.addRideButtonSubscription?.unsubscribe(),this.alertsSubscription.unsubscribe(),this.store.dispatch(D.clearRiderList())}createAddRideSubscription(){this.addRideButton&&(this.addRideButtonSubscription=K(this.addRideButton.nativeElement,"click").pipe(j(()=>this.defaultRideSchedule$.pipe(X(1),P(i=>this.store.dispatch(D.createRide({routeId:this.routeId,scheduleItem:i})))))).subscribe())}getCitiesByIds(i){return this.stationArr$.pipe(P(e=>e.filter(t=>i.includes(t.id))))}getCarriagesByCode(i){return this.carriagesArr$.pipe(P(e=>e.filter(t=>{t.code&&i.includes(t.code)})))}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=M({type:n,selectors:[["app-ride"]],viewQuery:function(e,t){if(e&1&&b(et,7),e&2){let r;S(r=T())&&(t.addRideButton=r.first)}},standalone:!0,features:[B],decls:16,vars:11,consts:[["addRideButton",""],["tuiTitle","l"],[1,"buttons"],["routerLinkActive","active","ariaCurrentWhenActive","page","routerLink","/admin/routes","size","s","tuiButton",""],["size","s","tuiButton",""],[1,"rides"],[3,"carriagesDataAllUpd","stationDataAllUpd","cityRide","idRide","rideSchedule","carriageRide","rideInfo","routeId"]],template:function(e,t){if(e&1&&(l(0,"h1",1),s(1),o(),l(2,"div",2)(3,"button",3),s(4," Back to routes "),o(),l(5,"button",4,0),s(7,"Add ride"),o()(),l(8,"div",5),E(9),$(10,"async"),E(11),$(12,"async"),E(13),$(14,"async"),p(15,rt,2,0),o()),e&2){c(),w("Route ",t.routeId,""),c(8);let r=A(F(10,2,t.riderInfo$));c(2);let d=A(F(12,5,t.stationArr$));c(2);let x=A(F(14,8,t.carriagesArr$));c(2),u(r&&d&&x&&r?15:-1)}},dependencies:[V,se,me,k,ne,U,Q],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;gap:2rem}.buttons[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:1rem;align-items:center}.rides[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}"]})};export{fe as RideComponent};
