import{a as ee,b as D}from"./chunk-AODPT3Y3.js";import{a as te}from"./chunk-4PWMRCJX.js";import{a as ne}from"./chunk-RXNC5GCW.js";import{c as q}from"./chunk-PT7V5Q2Q.js";import{a as ie}from"./chunk-346BXNRU.js";import{a as Z}from"./chunk-WNQC6ED5.js";import{a as X}from"./chunk-QJ4XV6RO.js";import{a as H,b as ae}from"./chunk-4EZILGJR.js";import"./chunk-BYXBJQAS.js";import{a as Y}from"./chunk-LRBDKUDH.js";import{d as G}from"./chunk-IMOUA4KZ.js";import{hb as J}from"./chunk-FEYVFRDP.js";import{d as re}from"./chunk-GYE77XHX.js";import{o as K,p as Q}from"./chunk-RR4QGK55.js";import{$b as F,Ca as B,Db as s,Eb as t,F as M,Fa as V,Jb as E,Ma as I,Mb as b,Na as h,Nb as f,Qc as L,Rc as j,Uc as W,Vc as z,Wb as r,Wc as R,Xb as N,Yb as p,_b as A,ac as k,db as o,ea as P,fc as U,gc as $,ha as S,k as T,lc as c,mc as l,nc as v,t as x,tb as g,va as u,vb as _}from"./chunk-2XEAWUUP.js";import"./chunk-T527G4PA.js";var ce=n=>n.orderState,oe=Q(ce,n=>n.orders);var O=class n{transform(i){return i.sort((e,d)=>this.compare(e.timeStart,d.timeStart))}compare(i,e){return new Date(i).getTime()-new Date(e).getTime()}static \u0275fac=function(e){return new(e||n)};static \u0275pipe=V({name:"sortByStartTime",type:n,pure:!0,standalone:!0})};var le=()=>[];function ue(n,i){if(n&1){let e=E();s(0,"button",7),b("click",function(){I(e);let a=f().$implicit,m=f();return h(m.showCancelDialog(a.id,a.userId))}),r(1," Cancel "),t()}}function fe(n,i){if(n&1&&(s(0,"div",4)(1,"div")(2,"span",5),r(3,"Start trip station:"),t(),r(4),t(),s(5,"div")(6,"span",5),r(7,"Start trip time:"),t(),r(8),c(9,"date"),t(),s(10,"div")(11,"span",5),r(12,"End trip station:"),t(),r(13),t(),s(14,"div")(15,"span",5),r(16,"End trip time:"),t(),r(17),c(18,"date"),t(),s(19,"div")(20,"span",5),r(21,"Trip duration:"),t(),r(22),c(23,"formatDuration"),t(),s(24,"div")(25,"span",5),r(26,"Carriage type:"),t(),r(27),t(),s(28,"div")(29,"span",5),r(30,"Car number:"),t(),r(31),t(),s(32,"div")(33,"span",5),r(34,"Seat number:"),t(),r(35),t(),s(36,"div")(37,"span",5),r(38,"Price:"),t(),r(39),c(40,"currency"),t(),g(41,ue,2,0,"button",6),t()),n&2){let e=i.$implicit;o(4),p(" ",e.stationStart,""),o(4),p(" ",v(9,10,e.timeStart,"MMMM dd hh:mm"),""),o(5),p(" ",e.stationEnd,""),o(4),p(" ",v(18,13,e.timeEnd,"MMMM dd hh:mm"),""),o(5),p(" ",v(23,16,e.timeStart,e.timeEnd)," "),o(5),p(" ",e.carriageType,""),o(4),p(" ",e.carriageNumber,""),o(4),p(" ",e.seatNumber,""),o(4),p(" ",l(40,19,e.price),""),o(2),_("ngIf",e.status==="active")}}function ge(n,i){if(n&1&&(s(0,"div")(1,"div"),r(2),t(),s(3,"div"),r(4),c(5,"async"),t()()),n&2){let e=f(2);o(2),p("Order ID: ",e.currentOrderId,""),o(2),p("Customer name: ",l(5,2,e.currentUserName$),"")}}function xe(n,i){if(n&1){let e=E();s(0,"div",8)(1,"h2",9),r(2,"Are you sure you want to cancel the order?"),t(),g(3,ge,6,4,"div",10),c(4,"async"),s(5,"button",11),b("click",function(){I(e);let a=f();return h(a.onCancelConfirm())}),r(6,"Confirm"),t()()}if(n&2){let e=f();o(3),_("ngIf",l(4,1,e.isManager$))}}var se=class n{store=u(K);orderService=u(ie);profileService=u(ee);adminService=u(te);alerts=u(q);currentOrderId=-1;currentUserId;isCancelDialogOpen=!1;currentUserName$=this.profileService.getUsers().pipe(x(i=>i.find(e=>e.id===(this.currentUserId||1))?.name));isManager$=this.store.select(re).pipe(x(i=>i==="manager"));alertsSubscription=this.orderService.alertMessage$.pipe(S(i=>i?this.alerts.open(i.message,{appearance:i.type}):T)).subscribe();orders$=this.store.select(oe).pipe(P(1),M(i=>i.length>0),S(i=>this.store.select(X).pipe(S(e=>this.store.select(Z).pipe(x(d=>i.map(a=>{let m=this.orderService.getStartStationIndex(a),de=this.orderService.getEndStationIndex(a),C=this.orderService.getCarriageIndex(a.seatId,a.carriages,e),w=a.carriages[C[0]],pe=this.orderService.getOrderPrice(a,w);return{id:a.id,stationStart:d.find(y=>a.stationStart===y.id)?.city||"",timeStart:a.schedule.segments[m].time[0],stationEnd:d.find(y=>a.stationEnd===y.id)?.city||"",timeEnd:a.schedule.segments[de].time[1],carriageType:w,carriageNumber:C[0]+1,seatNumber:C[1],price:pe,status:a.status,userId:a.userId}})))))));ngOnInit(){this.store.dispatch(D.loadOrders())}ngOnDestroy(){this.alertsSubscription.unsubscribe()}showCancelDialog(i,e){this.currentOrderId=i,this.currentUserId=e,this.isCancelDialogOpen=!0}onCancelConfirm(){this.store.dispatch(D.cancelOrder({orderId:this.currentOrderId})),this.isCancelDialogOpen=!1}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=B({type:n,selectors:[["app-orders"]],standalone:!0,features:[U],decls:8,vars:10,consts:[["tuiTitle","l",1,"title"],[1,"orders"],["tuiCardLarge","compact","tuiSurface","elevated","class","orders-card",4,"ngFor","ngForOf"],[3,"tuiDialogChange","tuiDialog"],["tuiCardLarge","compact","tuiSurface","elevated",1,"orders-card"],[1,"orders-card__subtitle"],["class","orders-card__button","tuiButton","","size","m","appearance","destructive",3,"click",4,"ngIf"],["tuiButton","","size","m","appearance","destructive",1,"orders-card__button",3,"click"],[1,"confirm-dialog"],["tuiTitle","m"],[4,"ngIf"],["tuiButton","","appearance","destructive",3,"click"]],template:function(e,d){e&1&&(s(0,"h1",0),r(1),c(2,"async"),t(),s(3,"div",1),g(4,fe,42,21,"div",2),c(5,"async"),c(6,"sortByStartTime"),t(),g(7,xe,7,3,"ng-template",3),k("tuiDialogChange",function(m){return F(d.isCancelDialogOpen,m)||(d.isCancelDialogOpen=m),m})),e&2&&(o(),N(l(2,3,d.isManager$)?"Orders":"My orders"),o(3),_("ngForOf",l(6,7,l(5,5,d.orders$)||$(9,le))),o(3),A("tuiDialog",d.isCancelDialogOpen))},dependencies:[W,L,z,R,j,ae,H,J,Y,ne,O,G],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;gap:2rem;justify-content:center;margin:2rem 1rem}.title[_ngcontent-%COMP%]{text-align:center}.orders[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:1rem;align-items:flex-start;justify-content:center}.orders-card[_ngcontent-%COMP%]{max-width:100%}.orders-card__subtitle[_ngcontent-%COMP%]{font-weight:700}.orders-card__button[_ngcontent-%COMP%]{align-self:flex-start}.confirm-dialog[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem;align-items:flex-start}"]})};export{se as OrdersComponent};
