import{a as K,b as Q,c as X,d as Y}from"./chunk-OC5GMCMG.js";import{a as T}from"./chunk-VQRAKSA7.js";import"./chunk-SQW3JKPY.js";import{F as J,J as Z}from"./chunk-ELI6RZET.js";import"./chunk-P56RC3A5.js";import{h as H}from"./chunk-OBQ5ZBLJ.js";import"./chunk-23NTSYVS.js";import"./chunk-NKXSX425.js";import"./chunk-GQC6GBTQ.js";import{a as ft}from"./chunk-4PWMRCJX.js";import{b as _t}from"./chunk-WNQC6ED5.js";import{b as dt}from"./chunk-QJ4XV6RO.js";import{hb as b,m as B,n as L,p as d,r as N,s as j,t as G,u as z,v as W,x as q}from"./chunk-FEYVFRDP.js";import{o as A,p as pt}from"./chunk-RR4QGK55.js";import{e as ut,f as ct,h as mt}from"./chunk-EH7XB44O.js";import{Ab as I,Bb as v,Ca as R,Cb as D,Db as a,Eb as n,Fb as C,Jb as x,Ma as _,Mb as m,Na as f,Nb as s,R as st,Ua as P,Uc as $,Wb as u,Xc as w,Yb as U,bc as E,cc as V,db as c,dc as F,fc as S,hc as lt,lc as k,mc as O,t as rt,tb as g,va as h,vb as p,yb as y,zb as ot}from"./chunk-2XEAWUUP.js";import"./chunk-T527G4PA.js";var xt=i=>i,gt=pt(xt,i=>i.routesState.routesList);function Rt(i,e){if(i&1&&C(0,"tui-data-list-wrapper",11),i&2){let t=s(2);p("items",t.processedStationData)}}function St(i,e){if(i&1){let t=x();a(0,"div",3)(1,"tui-select",7),m("ngModelChange",function(){let o=_(t).$index,l=s();return f(l.onSelectChangeStation(o))}),u(2," City "),C(3,"input",8),g(4,Rt,1,1,"tui-data-list-wrapper",9),n(),a(5,"button",10),m("click",function(){let o=_(t).$index,l=s();return f(l.removeStation(o))}),u(6,"delete"),n()()}if(i&2){let t=e.$index;c(),p("formControlName",t)}}function wt(i,e){if(i&1&&C(0,"tui-data-list-wrapper",11),i&2){let t=s(2);p("items",t.processedCarriagesData)}}function bt(i,e){if(i&1){let t=x();a(0,"div",5)(1,"tui-select",7),m("ngModelChange",function(){let o=_(t).$index,l=s();return f(l.onSelectChangeCarriages(o))}),u(2," Carriage "),C(3,"input",8),g(4,wt,1,1,"tui-data-list-wrapper",9),n(),a(5,"button",10),m("click",function(){let o=_(t).$index,l=s();return f(l.removeCarriage(o))}),u(6,"delete"),n()()}if(i&2){let t=e.$index;c(),p("formControlName",t)}}var tt=class i{routeData;stationDataAllUpd;carriagesDataAllUpd;formClosed=new P;store=h(A);formBuilder=h(W);updRouteForm=this.formBuilder.group({stations:this.formBuilder.array([new d(null)]),carriages:this.formBuilder.array([new d(null)])});ngOnInit(){this.setInitialValues()}get stations(){return this.updRouteForm.get("stations")}get carriages(){return this.updRouteForm.get("carriages")}get processedStationData(){return this.stationDataAllUpd?this.stationDataAllUpd.map(e=>e.city):null}get processedCarriagesData(){return this.carriagesDataAllUpd?this.carriagesDataAllUpd.map(e=>e.name):null}onSelectChangeStation(e){e===this.stations.length-1&&this.stations.push(new d(null))}onSelectChangeCarriages(e){e===this.carriages.length-1&&this.carriages.push(new d(null))}removeStation(e){this.stations.length>1&&this.stations.removeAt(e)}removeCarriage(e){this.carriages.length>1&&this.carriages.removeAt(e)}createRoute(){let e=this.mutateStations(Array.from(new Set(this.updRouteForm.get("stations")?.value.slice(0,-1)))),t=this.mutateCarriages(this.updRouteForm.get("carriages")?.value.filter(o=>o!==null));if(e.length<=1){alert("add at least two stations");return}if(t.length===0){alert("add at least one carriages");return}let r={path:e,carriages:t};this.routeData.id&&this.store.dispatch(T.updateRoute({idRoute:this.routeData.id,updRoute:r})),this.closeForm(),this.resetForm()}mutateStations(e){let t=[];if(this.stationDataAllUpd)for(let r of this.stationDataAllUpd)e.includes(r.city)&&t.push(r.id);return t}mutateCarriages(e){let t=[];if(this.carriagesDataAllUpd)for(let r=0;r<e.length;r+=1){let o=e[r];for(let l=0;l<this.carriagesDataAllUpd.length;l+=1){let M=this.carriagesDataAllUpd[l];M.code&&M.name===o&&t.push(M.code)}}return t}resetForm(){this.stations.clear(),this.carriages.clear(),this.stations.push(new d(null)),this.carriages.push(new d(null))}closeForm(){this.formClosed.emit()}setInitialValues(){if(this.routeData){let e=this.routeData.path||[];this.stations.clear(),e.forEach(r=>{let o=this.stationDataAllUpd?.find(l=>l.id===r);this.stations.push(new d(o?o.city:null))}),this.stations.push(new d(null));let t=this.routeData.carriages||[];this.carriages.clear(),t.forEach(r=>{let o=this.carriagesDataAllUpd?.find(l=>l.code===r);this.carriages.push(new d(o?o.name:null))}),this.carriages.push(new d(null))}}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=R({type:i,selectors:[["app-upd-route-form"]],inputs:{routeData:"routeData",stationDataAllUpd:"stationDataAllUpd",carriagesDataAllUpd:"carriagesDataAllUpd"},outputs:{formClosed:"formClosed"},standalone:!0,features:[S],decls:14,vars:1,consts:[[1,"upd-route-from",3,"formGroup"],[1,"upd-route-from__wrapper"],["formArrayName","stations",1,"upd-route-from__station"],[1,"upd-route-from__stations-container"],["formArrayName","carriages",1,"upd-route-from__carriages"],[1,"upd-route-from__carriages-container"],["size","s","tuiButton","",3,"click"],["tuiTextfieldSize","s",3,"ngModelChange","formControlName"],["placeholder","Choose your hero","tuiTextfieldLegacy",""],[3,"items",4,"tuiDataList"],["size","s","tuiButton","",1,"upd-route-from__delete-button",3,"click"],[3,"items"]],template:function(t,r){t&1&&(a(0,"form",0)(1,"div",1)(2,"div",2)(3,"h2"),u(4,"Select citys"),n(),v(5,St,7,1,"div",3,I),n(),a(7,"div",4)(8,"h2"),u(9,"Select carriages"),n(),v(10,bt,7,1,"div",5,I),n()(),a(12,"button",6),m("click",function(){return r.createRoute()}),u(13,"Update route"),n()()),t&2&&(p("formGroup",r.updRouteForm),c(5),D(r.stations.controls),c(5),D(r.carriages.controls))},dependencies:[q,N,B,L,j,z,G,Z,J,Y,Q,X,H,K,b,w],styles:[".upd-route-from[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:5px;align-items:flex-start;justify-content:center;margin-bottom:50px}.upd-route-from__wrapper[_ngcontent-%COMP%]{display:flex;flex:1;gap:5px;align-items:flex-start;justify-content:center;width:100%}.upd-route-from__station[_ngcontent-%COMP%], .upd-route-from__carriages[_ngcontent-%COMP%]{display:flex;flex:1;flex-direction:column;gap:5px}.upd-route-from__station[_ngcontent-%COMP%]   tui-select[_ngcontent-%COMP%], .upd-route-from__carriages[_ngcontent-%COMP%]   tui-select[_ngcontent-%COMP%]{width:calc(100% - 60px)}.upd-route-from__carriages-container[_ngcontent-%COMP%], .upd-route-from__stations-container[_ngcontent-%COMP%]{display:flex;align-items:center}.upd-route-from__delete-button[_ngcontent-%COMP%]{width:50px}button[_ngcontent-%COMP%]{width:80vw;margin:2.5px}"]})};var Tt=i=>["/admin/routes",i];function Mt(i,e){if(i&1&&(a(0,"div"),u(1),n()),i&2){let t=e.$implicit;c(),U("- ",t," -")}}function It(i,e){if(i&1&&(a(0,"div"),u(1),n()),i&2){let t=s().$implicit;c(),U("- ",t.city," -")}}function kt(i,e){if(i&1&&g(0,It,2,1,"div"),i&2){let t=e.$implicit;y(t?0:-1)}}function Ot(i,e){if(i&1){let t=x();a(0,"app-upd-route-form",6),m("formClosed",function(){_(t);let o=s();return f(o.closeRoutesCreateForm())}),n(),a(1,"button",5),m("click",function(){_(t);let o=s();return f(o.closeRoutesCreateForm())}),u(2,"Close update"),n()}if(i&2){let t=s();p("routeData",t.routeData)("stationDataAllUpd",t.stationDataAll)("carriagesDataAllUpd",t.carriagesDataAll)}}function Pt(i,e){if(i&1){let t=x();a(0,"button",5),m("click",function(){_(t);let o=s();return f(o.openRoutesUpdForm())}),u(1,"Update"),n()}}function Ut(i,e){if(i&1&&(a(0,"button",4),u(1," Asign ride "),n()),i&2){let t=s();p("routerLink",lt(1,Tt,t.routeData.id))}}var et=class i{routeData;stationData;stationDataAll;carriagesDataAll;store=h(A);isRoutesUpdFormOpen=!1;deleteRoute(){this.routeData.id&&this.store.dispatch(T.deleteRoute({pickRoute:this.routeData.id}))}openRoutesUpdForm(){this.isRoutesUpdFormOpen=!0}closeRoutesCreateForm(){this.isRoutesUpdFormOpen=!1}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=R({type:i,selectors:[["app-route-card"]],inputs:{routeData:"routeData",stationData:"stationData",stationDataAll:"stationDataAll",carriagesDataAll:"carriagesDataAll"},standalone:!0,features:[S],decls:20,vars:5,consts:[[1,"route-card"],[1,"route-card__carriage-arr"],[1,"route-card__station-arr"],["size","s","tuiButton",""],["routerLinkActive","active","ariaCurrentWhenActive","page","size","s","tuiButton","",3,"routerLink"],["size","s","tuiButton","",3,"click"],[3,"formClosed","routeData","stationDataAllUpd","carriagesDataAllUpd"]],template:function(t,r){t&1&&(a(0,"div",0)(1,"h2"),u(2),n(),a(3,"div")(4,"h3"),u(5,"Carriages:"),n(),a(6,"div",1),v(7,Mt,2,1,"div",null,ot),n()(),a(9,"h3"),u(10,"Citys:"),n(),a(11,"div",2),v(12,kt,1,1,null,null,ot),k(14,"async"),n(),g(15,Ot,3,3)(16,Pt,2,0,"button",3)(17,Ut,2,3,"button",4),a(18,"button",5),m("click",function(){return r.deleteRoute()}),u(19,"Delete"),n()()),t&2&&(c(2),U("Route ",r.routeData.id,""),c(5),D(r.routeData.carriages),c(5),D(O(14,3,r.stationData)),c(3),y(r.isRoutesUpdFormOpen?15:16),c(2),y(r.routeData.id?17:-1))},dependencies:[w,$,b,tt,ut,ct,mt],styles:[".route-card[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:5px;justify-content:center;width:50vw;padding:20px;border:1px solid gray;border-radius:10px}.route-card__carriage-arr[_ngcontent-%COMP%], .route-card__station-arr[_ngcontent-%COMP%]{display:flex;flex-flow:row wrap}button[_ngcontent-%COMP%]{width:50vw}"]})};function Et(i,e){if(i&1&&C(0,"tui-data-list-wrapper",11),i&2){let t=s(2);p("items",t.processedStationData)}}function Vt(i,e){if(i&1){let t=x();a(0,"div",3)(1,"tui-select",7),m("ngModelChange",function(){let o=_(t).$index,l=s();return f(l.onSelectChangeStation(o))}),u(2," City "),C(3,"input",8),g(4,Et,1,1,"tui-data-list-wrapper",9),n(),a(5,"button",10),m("click",function(){let o=_(t).$index,l=s();return f(l.removeStation(o))}),u(6,"delete"),n()()}if(i&2){let t=e.$index;c(),p("formControlName",t)}}function $t(i,e){if(i&1&&C(0,"tui-data-list-wrapper",11),i&2){let t=s(2);p("items",t.processedCarriagesData)}}function Bt(i,e){if(i&1){let t=x();a(0,"div",5)(1,"tui-select",7),m("ngModelChange",function(){let o=_(t).$index,l=s();return f(l.onSelectChangeCarriages(o))}),u(2," Carriage "),C(3,"input",8),g(4,$t,1,1,"tui-data-list-wrapper",9),n(),a(5,"button",10),m("click",function(){let o=_(t).$index,l=s();return f(l.removeCarriage(o))}),u(6," delete "),n()()}if(i&2){let t=e.$index;c(),p("formControlName",t)}}var it=class i{formClosed=new P;stationData;carriagesData;store=h(A);formBuilder=h(W);createRouteForm=this.formBuilder.group({stations:this.formBuilder.array([new d(null)]),carriages:this.formBuilder.array([new d(null)])});get stations(){return this.createRouteForm.get("stations")}get carriages(){return this.createRouteForm.get("carriages")}get processedStationData(){return this.stationData?this.stationData.map(e=>e.city):null}get processedCarriagesData(){return this.carriagesData?this.carriagesData.map(e=>e.name):null}onSelectChangeStation(e){e===this.stations.length-1&&this.stations.push(new d(null))}onSelectChangeCarriages(e){e===this.carriages.length-1&&this.carriages.push(new d(null))}removeStation(e){this.stations.length>1&&this.stations.removeAt(e)}removeCarriage(e){this.carriages.length>1&&this.carriages.removeAt(e)}createRoute(){let e=this.mutateStations(Array.from(new Set(this.createRouteForm.get("stations")?.value.slice(0,-1)))),t=this.mutateCarriages(this.createRouteForm.get("carriages")?.value.filter(o=>o!==null));if(e.length<=1){alert("add at least two stations");return}if(t.length===0){alert("add at least one carriages");return}let r={path:e,carriages:t};this.store.dispatch(T.addNewRoute({newRoute:r})),this.resetForm()}mutateStations(e){let t=[];if(this.stationData)for(let r of this.stationData)e.includes(r.city)&&t.push(r.id);return t}mutateCarriages(e){let t=[];if(this.carriagesData)for(let r=0;r<e.length;r+=1){let o=e[r];for(let l=0;l<this.carriagesData.length;l+=1){let M=this.carriagesData[l];M.code&&M.name===o&&t.push(M.code)}}return t}closeForm(){this.formClosed.emit()}resetForm(){this.stations.clear(),this.carriages.clear(),this.stations.push(new d(null)),this.carriages.push(new d(null))}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=R({type:i,selectors:[["app-create-route-form"]],inputs:{stationData:"stationData",carriagesData:"carriagesData"},outputs:{formClosed:"formClosed"},standalone:!0,features:[S],decls:16,vars:1,consts:[[1,"create-route-from",3,"formGroup"],[1,"create-route-from__wrapper"],["formArrayName","stations",1,"create-route-from__station"],[1,"create-route-from__stations-container"],["formArrayName","carriages",1,"create-route-from__carriages"],[1,"create-route-from__carriages-container"],["size","s","tuiButton","",3,"click"],["tuiTextfieldSize","s",3,"ngModelChange","formControlName"],["placeholder","Choose your hero","tuiTextfieldLegacy",""],[3,"items",4,"tuiDataList"],["size","s","tuiButton","",1,"create-route-from__delete-button",3,"click"],[3,"items"]],template:function(t,r){t&1&&(a(0,"form",0)(1,"div",1)(2,"div",2)(3,"h2"),u(4,"Select citys"),n(),v(5,Vt,7,1,"div",3,I),n(),a(7,"div",4)(8,"h2"),u(9,"Select carriages"),n(),v(10,Bt,7,1,"div",5,I),n()(),a(12,"button",6),m("click",function(){return r.createRoute()}),u(13,"Add route"),n()(),a(14,"button",6),m("click",function(){return r.closeForm()}),u(15,"Close create form"),n()),t&2&&(p("formGroup",r.createRouteForm),c(5),D(r.stations.controls),c(5),D(r.carriages.controls))},dependencies:[q,N,B,L,j,z,G,Z,J,Y,Q,X,H,K,b,w],styles:[".create-route-from[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:5px;align-items:flex-start;justify-content:center}.create-route-from__wrapper[_ngcontent-%COMP%]{display:flex;flex:1;gap:5px;align-items:flex-start;justify-content:center;width:100%}.create-route-from__station[_ngcontent-%COMP%], .create-route-from__carriages[_ngcontent-%COMP%]{display:flex;flex:1;flex-direction:column;gap:5px}.create-route-from__station[_ngcontent-%COMP%]   tui-select[_ngcontent-%COMP%], .create-route-from__carriages[_ngcontent-%COMP%]   tui-select[_ngcontent-%COMP%]{width:calc(100% - 60px)}.create-route-from__carriages-container[_ngcontent-%COMP%], .create-route-from__stations-container[_ngcontent-%COMP%]{display:flex;align-items:center}.create-route-from__delete-button[_ngcontent-%COMP%]{width:50px}button[_ngcontent-%COMP%]{width:80vw;margin:2.5px}"],changeDetection:0})};var Lt=(i,e)=>e.id;function Nt(i,e){if(i&1){let t=x();a(0,"app-create-route-form",2),m("formClosed",function(){_(t);let o=s(2);return f(o.closeRoutesCreateForm())}),n()}if(i&2){s(2);let t=F(0),r=F(2);p("stationData",r)("carriagesData",t)}}function jt(i,e){if(i&1&&g(0,Nt,1,2,"app-create-route-form",1),i&2){s();let t=F(0),r=F(2);y(r&&t?0:-1)}}function Gt(i,e){if(i&1){let t=x();a(0,"button",3),m("click",function(){_(t);let o=s();return f(o.openRoutesCreateForm())}),u(1,"Create"),n()}}function zt(i,e){if(i&1&&C(0,"app-route-card",4),i&2){let t=s().$implicit,r=s(2),o=F(0),l=F(2);p("routeData",t)("stationData",r.getCitiesByIds(t.path))("stationDataAll",l)("carriagesDataAll",o)}}function Wt(i,e){if(i&1&&g(0,zt,1,4,"app-route-card",4),i&2){s(2);let t=F(0),r=F(2);y(r&&t?0:-1)}}function qt(i,e){if(i&1&&v(0,Wt,1,1,null,null,Lt),i&2){s();let t=F(6);D(t)}}var Ct=class i{adminService=h(ft);store=h(A);routesList$=this.store.select(gt);stationArr$=this.store.select(_t);carriagesArr$=this.store.select(dt);isRoutesCreateFormOpen=!1;ngOnInit(){this.store.dispatch(T.loadRoutesAndStations())}openRoutesCreateForm(){this.isRoutesCreateFormOpen=!0}closeRoutesCreateForm(){this.isRoutesCreateFormOpen=!1}getCitiesByIds(e){return this.stationArr$.pipe(rt(t=>t.filter(r=>e.includes(r.id))),st())}getCarriagesByCode(e){return this.carriagesArr$.pipe(rt(t=>t.filter(r=>{r.code&&e.includes(r.code)})))}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=R({type:i,selectors:[["app-routes"]],standalone:!0,features:[S],decls:9,vars:11,consts:[["size","s","tuiButton",""],[3,"stationData","carriagesData"],[3,"formClosed","stationData","carriagesData"],["size","s","tuiButton","",3,"click"],[3,"routeData","stationData","stationDataAll","carriagesDataAll"]],template:function(t,r){if(t&1&&(E(0),k(1,"async"),E(2),k(3,"async"),g(4,jt,1,1)(5,Gt,2,0,"button",0),E(6),k(7,"async"),g(8,qt,2,0)),t&2){V(O(1,2,r.carriagesArr$)),c(2),V(O(3,5,r.stationArr$)),c(2),y(r.isRoutesCreateFormOpen?4:5),c(2);let o=V(O(7,8,r.routesList$));c(2),y(o?8:-1)}},dependencies:[b,w,$,et,it],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;gap:10px;align-items:center;justify-content:center}button[_ngcontent-%COMP%]{width:50vw}"]})};export{Ct as RoutesComponent};
